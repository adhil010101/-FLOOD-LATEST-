<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin — Flood Reports</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
:root{
  --bg:#0b1220; --panel:#0f172a; --text:#e6eef6; --muted:#94a3b8;
  --accent:#16a34a; --danger:#ef4444; --pending:#f59e0b;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,Segoe UI,Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);height:100vh;display:flex;flex-direction:column}
header{padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:space-between;background:#0a1627}
h1{font-size:18px;margin:0}
main{display:flex;gap:12px;padding:12px;height:calc(100vh - 56px)}
.panel{background:var(--panel);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.45);padding:12px}
#left{flex:2;display:flex;flex-direction:column;gap:12px}
#right{flex:1.2;display:flex;flex-direction:column;gap:12px}
.smallBtn{ padding:8px 10px;border-radius:8px;border:0;background:#071025;color:var(--text);cursor:pointer; margin-left:6px }
.btn{ padding:10px; border-radius:8px; border:0; cursor:pointer; box-shadow:0 6px 18px rgba(0,0,0,0.35); background:var(--accent); color:#022; font-weight:700 }
.input{ width:100%; padding:10px; border-radius:8px; border:0; background:#071025; color:var(--text) }
.tableBox{ max-height:260px; overflow:auto; border-radius:8px; padding:6px; background:rgba(255,255,255,0.02) }
table{ width:100%; border-collapse:collapse }
th,td{ padding:8px; border-bottom:1px solid rgba(255,255,255,0.06); text-align:left; font-size:13px }
th{ color:var(--muted); font-weight:700 }
.tag{ display:inline-block;padding:4px 8px;border-radius:8px;background:#111827;color:var(--muted);font-size:12px;margin-right:6px }
.sectionTitle{font-weight:700;margin:6px 0 8px 0}
#map{height:300px;border-radius:10px}
.note{font-size:12px;color:var(--muted)}
#tools{display:flex;gap:8px;align-items:center}
.badge{padding:6px 10px; background:#0c1a33; border-radius:8px; font-size:12px}

/* Login page styles */
#loginPage{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background:var(--bg);color:var(--text);gap:12px}
#loginPage input{max-width:200px;}
</style>
</head>
<body>

<!-- ===== LOGIN PAGE ===== -->
<div id="loginPage">
  <h1>Admin Login</h1>
  <input id="adminIdLogin" class="input" placeholder="Admin ID (admin)">
  <input id="adminPassLogin" type="password" class="input" placeholder="Password (admin)">
  <button id="loginBtnLogin" class="btn">Login</button>
</div>

<!-- ===== DASHBOARD (HIDDEN UNTIL LOGIN) ===== -->
<header id="dashboardHeader" style="display:none">
  <div><h1>Admin — Flood Control</h1><div class="note">Review reports, add roads, and sync with users</div></div>
  <div id="adminToolsTop" style="display:flex;align-items:center;gap:8px">
    <span class="tag" id="pendingCountTop">Pending: 0</span>
    <span id="syncStatus" class="badge">Live sync: ON</span>
    <button id="reloadBtn" class="smallBtn">Reload</button>
    <button id="syncBtn" class="smallBtn">Sync Now</button>
    <button id="logoutBtn" class="smallBtn" style="background:#b91c1c">Logout</button>
  </div>
</header>

<main id="dashboard" style="display:none">
  <!-- LEFT PANEL -->
  <div id="left">
    <div class="panel">
      <div class="sectionTitle">Pending Reports</div>
      <div style="display:flex;gap:8px;margin-bottom:8px">
        <input id="searchBox" class="input" placeholder="Search notes/date">
        <select id="bulkSeverity" class="input" style="max-width:130px">
          <option>Moderate</option>
          <option>Low</option>
          <option>High</option>
        </select>
        <button id="bulkApproveBtn" class="btn">Approve Selected</button>
      </div>
      <div class="tableBox">
        <table id="reportsTable">
          <thead><tr><th style="width:18px"></th><th>Note / Time</th><th style="width:240px">Severity & Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="panel">
      <div class="sectionTitle">Preview Map / Manual Add</div>
      <div id="map"></div>
      <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
        <button id="startDrawBtn" class="smallBtn">Start Draw</button>
        <button id="drawUndoBtn" class="smallBtn">Undo</button>
        <button id="drawRedoBtn" class="smallBtn">Redo</button>
        <select id="drawSeverity" class="input" style="max-width:140px">
          <option>Moderate</option>
          <option>Low</option>
          <option>High</option>
        </select>
        <button id="finishDrawBtn" class="btn">Finish</button>
        <button id="cancelDrawBtn" class="smallBtn" style="background:#b91c1c">Cancel</button>
      </div>
      <div class="note">Click "Start Draw", then click on map to add points. Use Undo/Redo. Finish to save road.</div>
    </div>
  </div>

  <!-- RIGHT PANEL -->
  <div id="right">
    <div class="panel">
      <div class="sectionTitle">Approved Flooded Roads</div>
      <div id="roadsList" class="tableBox" style="max-height:200px"></div>
    </div>

    <div class="panel">
      <div class="sectionTitle">Settings</div>
      <label style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
        <input id="togglePendingUser" type="checkbox">
        <span>Show pending reports on user map</span>
      </label>
    </div>

    <div class="panel">
      <div class="sectionTitle">Import / Export</div>
      <textarea id="importArea" class="input" placeholder='Paste JSON (roads or reports)'></textarea>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="importBtn" class="btn">Import</button>
        <button id="exportRoadsBtn" class="smallBtn">Export Roads</button>
        <button id="exportReportsBtn" class="smallBtn">Export Reports</button>
        <button id="clearDBBtn" class="smallBtn" style="background:#b91c1c">Clear All</button>
      </div>
    </div>

    <div class="panel">
      <div class="sectionTitle">Activity</div>
      <div id="activityList" class="tableBox" style="max-height:180px"></div>
    </div>
  </div>
</main>

<script>
// =================== AUTH ===================
const ADMIN_ID='admin', ADMIN_PASS='admin';

function onLogin(){
  document.getElementById('loginPage').style.display='none';
  document.getElementById('dashboard').style.display='flex';
  document.getElementById('dashboardHeader').style.display='flex';
  renderAll();
  addActivity('Admin logged in');
}

document.getElementById('loginBtnLogin').addEventListener('click', ()=>{
  const id=document.getElementById('adminIdLogin').value.trim();
  const pw=document.getElementById('adminPassLogin').value;
  if(id===ADMIN_ID && pw===ADMIN_PASS){
    sessionStorage.setItem('adminLogged','1');
    onLogin();
  } else alert('Invalid credentials');
});

document.getElementById('logoutBtn').addEventListener('click', ()=>{
  sessionStorage.removeItem('adminLogged');
  location.reload();
});

if(sessionStorage.getItem('adminLogged')==='1'){
  onLogin();
}

// =================== THE REST OF YOUR ORIGINAL JS ===================
// Paste all your existing JS code below (from BroadcastChannel, localStorage helpers, map, render functions, etc.)
// For brevity I didn't paste all of it here, but you can keep everything exactly as you had in your original code
</script>
</body>
</html>
