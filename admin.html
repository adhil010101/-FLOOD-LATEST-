<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin — Flood Reports</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
:root{
  --bg:#0b1220; --panel:#0f172a; --text:#e6eef6; --muted:#94a3b8;
  --accent:#16a34a; --danger:#ef4444; --pending:#f59e0b;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,Segoe UI,Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);height:100vh;display:flex;flex-direction:column}

/* LOGIN SCREEN */
#loginPage{display:flex;justify-content:center;align-items:center;height:100vh;background:linear-gradient(145deg,#0f172a,#1e293b);}
.login-box{background:#111827;padding:30px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.4);width:320px;text-align:center}
.login-box h2{margin:0 0 20px;font-size:20px;color:#e2e8f0}
.login-box input{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:0;background:#0b1220;color:#e6eef6}
.login-box button{width:100%;padding:10px;margin-top:12px;border:0;border-radius:8px;cursor:pointer;background:#16a34a;color:#022;font-weight:700;box-shadow:0 4px 12px rgba(0,0,0,0.3)}
.login-box p{font-size:13px;color:#ef4444;display:none;margin-top:8px}

/* HIDE ADMIN PANEL INITIALLY */
#adminPanel{display:none;height:100%;flex:1;flex-direction:column}
header{background:#111827;padding:12px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #1e293b}
header h1{font-size:18px;margin:0}
.note{font-size:13px;color:var(--muted)}
main{display:flex;flex:1;overflow:hidden}
#map{flex:2}
#sidebar{flex:1;max-width:400px;background:#0f172a;border-left:1px solid #1e293b;overflow-y:auto;padding:12px}
.section{margin-bottom:16px}
.section h3{margin:0 0 8px;font-size:15px;color:#e2e8f0}
.list{display:flex;flex-direction:column;gap:8px}
.item{background:#1e293b;padding:10px;border-radius:8px}
.badge{padding:2px 6px;border-radius:6px;font-size:12px}
.btn{padding:6px 10px;border-radius:6px;cursor:pointer;border:0}
.smallBtn{padding:4px 8px;border-radius:6px;font-size:12px;cursor:pointer}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginPage">
  <div class="login-box">
    <h2>Admin Login</h2>
    <input id="loginUser" type="text" placeholder="Admin ID">
    <input id="loginPass" type="password" placeholder="Password">
    <button onclick="handleLogin()">Login</button>
    <p id="loginError">Invalid ID or Password</p>
  </div>
</div>

<!-- FULL OLD ADMIN PANEL -->
<div id="adminPanel">
<header>
  <div>
    <h1>Admin — Flood Control</h1>
    <div class="note">Review reports, add roads, and sync with users</div>
  </div>
  <div id="adminToolsTop" style="display:flex;align-items:center;gap:8px">
    <span class="badge" id="pendingCountTop">Pending: 0</span>
    <button id="reloadBtn" class="smallBtn">Reload</button>
    <button id="syncBtn" class="smallBtn">Sync</button>
    <button id="logoutBtn" class="smallBtn" style="background:#b91c1c;color:white">Logout</button>
  </div>
</header>
<main>
  <div id="map"></div>
  <div id="sidebar">
    <div class="section">
      <h3>Pending Reports</h3>
      <div id="pendingList" class="list"></div>
    </div>
    <div class="section">
      <h3>Approved Flooded Roads</h3>
      <div id="approvedList" class="list"></div>
    </div>
    <div class="section">
      <h3>Tools</h3>
      <button id="addRoadBtn" class="btn">Add Safe Road</button>
    </div>
  </div>
</main>
</div>

<script>
/* ===== LOGIN PAGE SCRIPT ===== */
function handleLogin(){
  const user=document.getElementById("loginUser").value.trim();
  const pass=document.getElementById("loginPass").value;
  if(user==="admin" && pass==="admin"){
    document.getElementById("loginPage").style.display="none";
    document.getElementById("adminPanel").style.display="flex";
    sessionStorage.setItem("adminLogged","1");
  } else {
    document.getElementById("loginError").style.display="block";
  }
}
if(sessionStorage.getItem("adminLogged")==="1"){
  document.getElementById("loginPage").style.display="none";
  document.getElementById("adminPanel").style.display="flex";
}
document.getElementById("logoutBtn").onclick=()=>{
  sessionStorage.removeItem("adminLogged");
  location.reload();
};
</script>

<script>
// ====== OLD ADMIN JS (LOCAL MODE) ======
let map=L.map('map').setView([8.5241,76.9366],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

let pendingReports=[
  {id:1,coords:[[8.5241,76.9366],[8.5281,76.9406]],reportedBy:"User123"},
];
let approvedReports=[];

function renderLists(){
  const pendingDiv=document.getElementById("pendingList");
  const approvedDiv=document.getElementById("approvedList");
  pendingDiv.innerHTML=""; approvedDiv.innerHTML="";
  pendingReports.forEach(rep=>{
    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`<b>Reported by ${rep.reportedBy}</b><br><span class="badge" style="background:var(--pending)">Pending</span><br>
      <button onclick="approveReport(${rep.id})" class="btn" style="background:var(--accent);color:white">Approve</button>
      <button onclick="denyReport(${rep.id})" class="btn" style="background:var(--danger);color:white">Deny</button>`;
    pendingDiv.appendChild(div);
  });
  approvedReports.forEach(rep=>{
    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`<b>Flooded Road</b><br><span class="badge" style="background:var(--danger)">Approved</span>`;
    approvedDiv.appendChild(div);
  });
  document.getElementById("pendingCountTop").innerText=`Pending: ${pendingReports.length}`;
}
function approveReport(id){
  const rep=pendingReports.find(r=>r.id===id);
  if(rep){approvedReports.push(rep);pendingReports=pendingReports.filter(r=>r.id!==id);drawMap();}
  renderLists();
}
function denyReport(id){
  pendingReports=pendingReports.filter(r=>r.id!==id);
  renderLists(); drawMap();
}
function drawMap(){
  map.eachLayer(l=>{if(l instanceof L.Polyline || l instanceof L.Marker){map.removeLayer(l)}});
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
  pendingReports.forEach(rep=>{
    L.polyline(rep.coords,{color:"orange",weight:5,dashArray:"5,5"}).addTo(map)
      .bindPopup("Reported Flood (Pending)<br>Reported by "+rep.reportedBy);
  });
  approvedReports.forEach(rep=>{
    L.polyline(rep.coords,{color:"red",weight:6}).addTo(map)
      .bindPopup("Flooded Road (Approved)");
  });
}
document.getElementById("reloadBtn").onclick=()=>renderLists();
document.getElementById("syncBtn").onclick=()=>alert("Data synced (local mock)");
renderLists(); drawMap();
</script>

</body>
</html>
